<?php

if(empty($_POST['file_opp_files'])){
	$errors[]="Vous devez sélectionner au moins un fichier pour l'opportunité";
}
foreach ($notMandatoryFields as $key => $field) {
	if(empty($_POST[$field['field']])){
		$errors[]=$field['warning'];
	}
}

if(empty($errors)){
	$idOpp=$oppDao->addOpportunite();
	if(isset($idOpp)&& ($idOpp>0)){

		for ($i=0; $i <count($_POST['file_opp_files']) ; $i++) {
			$ext = pathinfo($_POST['file_opp_files'][$i], PATHINFO_EXTENSION);
			$image=(in_array(strtolower($ext),$imgExt))? 1:0;
			$oppDao->addMainFile($idOpp,$_POST['file_opp_files'][$i],$_POST['readable_opp_files'][$i], $image,$_POST['ordre_opp_files'][$i]);
		}

		if(isset($_POST['icons'])){
			$oppDao->addIcons($idOpp,$_POST['icons']);
		}
		if(!empty($_POST['file_addons_files'])){
			for ($i=0; $i < count($_POST['file_addons_files']); $i++) {
				$oppDao->addAddonsFile($idOpp,$_POST['file_addons_files'][$i], $_POST['readable_addons_files'][$i]);
			}
		}
		header("Location: opp-preview.php?id=".$idOpp,true,303);

	}else{
		$errors[]="Une erreur est survenue, impossible d'enregistrer l'opportunité";
	}
}



