<?php
require('../../config/autoload.php');
if(!isset($_SESSION['id'])){
	header('Location:'. ROOT_PATH.'/index.php');
	exit();
}
require '../../config/db-connect.php';

//			css dynamique
//----------------------------------------------------------------
$pageCss=explode(".php",basename(__file__));
$pageCss=$pageCss[0];
$cssFile=ROOT_PATH ."/public/css/".$pageCss.".css";


//------------------------------------------------------
//			REQUIRES
//------------------------------------------------------
// require_once '../../vendor/autoload.php';



//---------------------------------------
//	ajout enreg dans stat
//---------------------------------------
// require "../../functions/stats.fn.php";
// addRecord($pdoStat,basename(__file__),'consultation', "fichiers d'info du service achats", 101);


 //------------------------------------------------------
//			DECLARATIONS
//------------------------------------------------------
$errors=[];
$success=[];

function scandirfn($path){
	// glob => liste un contenu en fonction d'un motif et retour un array
	// 1er arg, contenu (ici chemin) et 2eme arg motif (si chercher tous les jpg : *.jpg)
	$content=glob($path."/*");
	$result=array();

	foreach($content as $data)
	{
		// is_dir() retourne true si arg = rÃ©pertoire
		if(is_dir($data))
		{
			$result=array_merge($result, scandirfn($data));
		}
		else
		{
			array_push($result, $data);
		}
	}
	return $result;
}


function dateFile($fileName){
	$fileDate=new DateTime();
	$fileDate->setTimestamp(filemtime($fileName));
	return $fileDate;
}



	//liste des fichiers
$path='d:\www\_intranet\_btlecest';
$myFileList=scandirfn($path);
	//date de comparaison
$dateLimit= new DateTime();
$dateLimit->modify('- 4 days');

//------------------------------------------------------
//			FONCTION
//------------------------------------------------------

$i=0;
//------------------------------------------------------
//			VIEW
//------------------------------------------------------
include('../view/_head-bt.php');
include('../view/_navbar.php');
?>
<!--********************************
DEBUT CONTENU CONTAINER
*********************************-->
<div class="container">
	<h1 class="text-main-blue py-5 ">Main title</h1>

	<div class="row">
		<div class="col-lg-1"></div>
		<div class="col">
			<?php
			include('../view/_errors.php');
			?>
		</div>
		<div class="col-lg-1"></div>
	</div>
	<?php foreach ($myFileList as $value): ?>

		<?php if (dateFile($value)>=$dateLimit): ?>
		<div class="row">
			<div class="col-5">
				<?=$i.'- '.str_replace('d:\www\_intranet\_btlecest/',"",$value)?>
			</div>
			<div class="col">
				<?=dateFile($value)->format('d-m-Y')?>
			</div>
		</div>
		<?php $i++ ?>
	<?php endif ?>
<?php endforeach ?>

<!-- ./container -->
</div>

<?php
require '../view/_footer-bt.php';
?>