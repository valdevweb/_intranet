<?php
require('../../config/autoload.php');
if(!isset($_SESSION['id'])){
	echo "pas de variable session";
	header('Location:'. ROOT_PATH.'/index.php');
}
//			css dynamique
//----------------------------------------------------------------
$pageCss=explode(".php",basename(__file__));
$pageCss=$pageCss[0];
$cssFile=ROOT_PATH ."/public/css/".$pageCss.".css";


//------------------------------------------------------
//			REQUIRES
//------------------------------------------------------
// require_once '../../vendor/autoload.php';
require_once '../../Class/MagDbHelper.php';
require_once '../../Class/Mag.php';
//---------------------------------------
//	STRUCTURE PAGE HTML
//---------------------------------------
/*





 */


//---------------------------------------
//	ajout enreg dans stat
//---------------------------------------
// require "../../functions/stats.fn.php";
// addRecord($pdoStat,basename(__file__),'consultation', "fichiers d'info du service achats", 101);


 //------------------------------------------------------
//			DECLARATIONS
//------------------------------------------------------
$errors=[];
$success=[];
// $searchResults=false;

if(isset($_POST['search_form'])){
	$searchTerm=$_POST['search_term'];
	$magDbHelper=new MagDbHelper($pdoMag);
	$searchResults=$magDbHelper->basicSearch($searchTerm);
}
if(isset($_POST['clear_form'])){
	$_POST=[];
	// $magList=getMagMsg($pdoMag);

}
if (isset($_GET['btlec'])){
	$magDbHelper=new MagDbHelper($pdoMag);
	$mag=$magDbHelper->getMagBt($_GET['btlec']);

	$centraleGessica=$magDbHelper->centraleToString($mag->getCentrale());
}

	// echo "<pre>";
	// print_r($searchResults);
	// echo '</pre>';




//------------------------------------------------------
//			FONCTION
//------------------------------------------------------


//------------------------------------------------------
//			VIEW
//------------------------------------------------------


include('../view/_head-bt.php');
include('../view/_navbar.php');
?>
<!--********************************
DEBUT CONTENU CONTAINER
*********************************-->
<div class="container">
	<h1 class="text-main-blue pt-5 ">Base magasin Consultation</h1>

	<div class="row">
		<div class="col-lg-1"></div>
		<div class="col">
			<?php
			include('../view/_errors.php');
			?>
		</div>
		<div class="col-lg-1"></div>
	</div>
	<!-- ******************************************
		01 zone recherche et affichage resultats
		******************************************-->
		<div class="row">
			<div class="col-lg-1"></div>
			<div class="col border py-3">
				<!-- line one -->
				<div class="row">
					<div class="col">
						<p class="text-orange">Rechercher un magasin :</p>
						<form action="<?= htmlspecialchars($_SERVER['PHP_SELF'])?>" method="post" class="form-inline">
							<div class="form-group">
								<input class="form-control mr-5 pr-5" placeholder="deno, ville, panonceau galec, code BT" name="search_term" id="search-zone" type="text"
								value="<?=isset($searchTerm)? $searchTerm: false?>">
							</div>
							<button class="btn btn-primary mr-5" type="submit"  name="search_form"><i class="fas fa-search pr-2"></i>Rechercher</button>
							<button class="btn btn-orange" type="submit"  name="clear_form"><i class="fas fa-eraser pr-2"></i>Effacer</button>
						</form>
					</div>
				</div>
				<!-- line two -->
				<?php if (isset($searchResults) && !empty($searchResults)): ?>
				<div class="row mt-3">
					<div class="col-1"></div>
					<div class="col p-3" >
						<div class="text-main-blue mb-2"> <i class="fas fa-search pr-3"></i>Résultats de votre recherche :</div>
						<?php foreach ($searchResults as $searchResult): ?>
							<a class="pl-5 link-nocolor" href="<?=$_SERVER['PHP_SELF']?>?btlec=<?=$searchResult->getId()?>">
								<?=
								ucwords(strtolower($searchResult->getDeno())) . ' - '.ucwords(strtolower($searchResult->getVille()))
								.' ('.$searchResult->getId() .' - '. $searchResult->getGalec().')'
								?>
							</a><br>
						<?php endforeach ?>
					</div>
					<div class="col-1"></div>
				</div>
			<?php endif ?>
		</div>
		<div class="col-lg-1"></div>
	</div>
	<!-- ******************************************
		zone info mag
		****************************************** -->

		<?php if (isset($_GET['btlec'])): ?>
			<div class="row bg-light-grey py-2">
				<div class="col-2"></div>
				<div class="col-8 border  py-3 ">
					<div class="row">
						<div class="col">
							<h5 class="text-center yanone">Légende :</h5>
						</div>
					</div>
					<div class="row">
						<div class="col scadif-txt"><i class="fas  fa-circle pr-3"></i>Scadif</div>
						<div class="col scapnor-txt"><i class="fas  fa-circle pr-3"></i>Scapnor</div>
						<div class="col scapalsace-txt"><i class="fas  fa-circle pr-3"></i>Scapalsace</div>
						<div class="col socamil-txt"><i class="fas fa-circle pr-3"></i>Socamil</div>
					</div>
					<div class="row">

					</div>
					<div class="row">
						<div class="col scapartois-txt"><i class="fas  fa-circle pr-3"></i>Scapartois</div>
						<div class="col socara-txt"><i class="fas  fa-circle pr-3"></i>Socara</div>
						<div class="col scapest-txt"><i class="fas  fa-circle pr-3"></i>Scapest</div>
						<div class="col scacentre-txt"><i class="fas  fa-circle pr-3"></i>Scacentre</div>

					</div>
					<div class="row">
						<div class="col lecasud-txt"><i class="fas  fa-circle pr-3"></i>Lecasud</div>

					</div>
				</div>

			</div>

			<!-- infos generales 1/3  -->
			<div class="row">
				<div class="col mt-5 text-main-blue">
					Informations générales
				</div>
			</div>
			<div class="row libelle">
				<div class="col-lg-4">
					Dénomination :
				</div>
				<div class="col-lg-2">
					BTLEC - Galec :
				</div>
				<div class="col-lg-3">
					Adhérent :
				</div>
				<div class="col-lg-3">
					Directeur :
				</div>
			</div>

			<div class="row">
				<div class="col-lg-4">
					<div class=""><?= $mag->getDenoSca();?></div>
				</div>
				<div class="col-lg-2">
					<div class=""><?= $mag->getId() . ' - ' . $mag->getGalecSca();?></div>
				</div>
				<div class="col-lg-3">
					<div class=""><?= $mag->getAdherentSca();?></div>
				</div>
				<div class="col-lg-3">
					<div class=""></div>
				</div>
			</div>


			<!-- infos generales 2/3  -->

			<div class="row libelle">
				<div class="col-lg-4">
					Centrale Gessica :
				</div>
				<div class="col-lg-2">
					Pole SAV Gessica:
				</div>
				<div class="col-lg-3">
					Surface :
				</div>
				<div class="col-lg-3">

				</div>
			</div>
			<div class="row">
				<div class="col-lg-4">
					<div class="data <?=strtolower($centraleGessica)?>-bg-clear"><?= $centraleGessica ?></div>
				</div>
				<div class="col-lg-2">
					<div class="data <?=strtolower($centraleGessica)?>-bg-clear"><?= $mag->getPoleSavGessica();?></div>
				</div>
				<div class="col-lg-3">
					<div class="data <?=strtolower($centraleGessica)?>-bg-clear"><?= $mag->getSurfaceStrg();?></div>
				</div>
				<div class="col-lg-3">
					<div class="data <?=strtolower($centraleGessica)?>-bg-clear"><?= $mag->getDirecteur();?></div>
				</div>
			</div>
			<!-- infos generales 3/3  -->
			<div class="row libelle">
				<div class="col-lg-6">
					Adresse :
				</div>

				<div class="col-lg-3">
					Téléphone :
				</div>
				<div class="col-lg-3">
					Fax :
				</div>
			</div>
			<div class="row">
				<div class="col-lg-6 ">
					<div class="data <?=strtolower($centraleGessica)?>-bg-clear"><?php $ad2=!empty($mag->getAd2()) ? $mag->getAd2().'<br>' :''?>
					<?= $mag->getAd1() .'<br>'.$ad2. $mag->getCp() . ' '.$mag->getVille() ?>
				</div>
			</div>

			<div class="col-lg-3">
				<div class="data <?=strtolower($centraleGessica)?>-bg-clear"><?= $mag->getTel();?></div>
			</div>
			<div class="col-lg-3">
				<div class="data <?=strtolower($centraleGessica)?>-bg-clear"><?= $mag->getFax();?></div>
			</div>
		</div>

		<!-- historique 1/  -->
		<div class="row">
			<div class="col mt-5 text-main-blue">
				Historique magasin
			</div>
		</div>



		<div class="row">
			<div class="col">
				<form action="<?=$_SERVER['PHP_SELF']?>?btlec=<?=$_GET['btlec']?>">

					<div class="row">
						<div class="col">
							<div class="form-group">
								<label for="model"></label>
								<input type="text" class="form-control" name="model" id="model">
							</div>
						</div>
						<div class="col-lg-3">
							<div class="form-group">
								<label for="model"></label>
								<input type="text" class="form-control" name="model" id="model">
							</div>
						</div>
						<div class="col-lg-3">
							<div class="form-group">
								<label for="model"></label>
								<input type="text" class="form-control" name="model" id="model">
							</div>
						</div>
					</div>
				</form>
			</div>
		</div>


	<?php endif ?>

	<!-- ./container -->
</div>


<script type="text/javascript">
	$(document).ready(function(){
		$('.basicAutoComplete').autoComplete({
			resolverSettings: {
				url: 'testdata/test-list.json'
			}
		});
	});

</script>

<?php
require '../view/_footer-bt.php';
?>