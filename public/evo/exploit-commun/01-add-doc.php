<?php

$listFilename=[];
if(isset($_FILES['files_doc']['tmp_name'][0]) &&  !empty($_FILES['files_doc']['tmp_name'][0])){
	for ($i=0; $i <count($_FILES['files_doc']['tmp_name']) ; $i++) {
		if(empty($_POST['filename'][$i])){
			$warning=true;
		}
		if(!$warning){
			$orginalFilename=$_FILES['files_doc']['name'][$i];
			$ext = pathinfo($orginalFilename, PATHINFO_EXTENSION);
			$filenameNoExt = basename($orginalFilename, '.'.$ext);
			$filename = str_replace(' ', '_', $filenameNoExt) . '_' . time() . '.' . $ext;
			$filename = str_replace("'", '', $filename);
			$uploaded=move_uploaded_file($_FILES['files_doc']['tmp_name'][$i],UPLOAD_DIR_EVO.$filename );
			if($uploaded==false){
				$errors[]="Nous avons rencontré avec votre fichier, votre demande n'a pas pu être enregistrée 2";
			}else{
				$listFilename[]=$filename;
			}
		}
	}
}
if($warning){
	$errors[]="Merci de donner un nom à vos fichiers";
}
if(!empty($listFilename) && empty($errors)){
	for ($i=0; $i < count($listFilename); $i++) {
		$evoDao->insertDocTable($table, $idName, $_GET['id'], $listFilename[$i], $_POST['filename'][$i], $_POST['cmt'][$i], $_POST['url'][$i], $_POST['urlname'][$i]);
	}
	$successQ='?success=doc&id='.$_GET['id'];
	unset($_POST);
	header("Location: ".$_SERVER['PHP_SELF'].$successQ,true,303);
}

if(empty($listFilename) && empty($errors)){

	$do=$evoDao->insertDocTable($table, $idName, $_GET['id'], "", "", $_POST['cmt'][0], $_POST['url'][0], $_POST['urlname'][0]);

	$successQ='?success=doc&id='.$_GET['id'];
	unset($_POST);
	header("Location: ".$_SERVER['PHP_SELF'].$successQ,true,303);

}

