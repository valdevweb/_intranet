<?php
require('../../config/autoload.php');
if(!isset($_SESSION['id'])){
	header('Location:'. ROOT_PATH.'/index.php');
	exit();
}

$pageCss=explode(".php",basename(__file__));
$pageCss=$pageCss[0];
$cssFile=ROOT_PATH ."/public/css/".$pageCss.".css";


require '../../Class/Db.php';
require '../../Class/Evo/EvoDao.php';
require '../../Class/Evo/EvoHelpers.php';
require '../../Class/FormHelpers.php';
require '../../Class/Evo/PlateformeDao.php';
// require_once '../../vendor/autoload.php';


$errors=[];
$success=[];
$db=new Db();
$pdoUser=$db->getPdo('web_users');
$pdoEvo=$db->getPdo('evo');

$evoDao=new EvoDao($pdoEvo);
$plateformeDao=new PlateformeDao($pdoEvo);

$arrayResp=EvoHelpers::arrayRespShort($pdoEvo);


	$plateform=$evoDao->getPlateforme($_GET['id']);

if (isset($_GET['id'])){
	if(isset($_POST['modify-plateforme'])){
		$done=$evoDao->updatePlateforme($_GET['id']);
		if($done==1){
			$successQ='?success=maj-plateforme&id='.$_GET['id'];
			unset($_POST);
			header("Location: ".$_SERVER['PHP_SELF'].$successQ,true,303);
		}
	}
}


if(isset($_GET['success'])){
	$arrSuccess=[
		'add-plateforme'=>'Plateforme ajoutée',
		'del-plateforme'=>'Plateforme supprimée',
		'maj-plateforme'=>'Plateforme modifiée',
		'add-appli'=>'Appli ajoutée',
	];
	$success[]=$arrSuccess[$_GET['success']];
}

//------------------------------------------------------
include('../view/_head-bt.php');
include('../view/_navbar.php');
?>

<div class="container">
	<div class="row py-5">
		<div class="col">
			<h1 class="text-main-blue"><?=$plateform['plateforme']?></h1>
		</div>
		<div class="col text-right">
			<a href="exploit-main.php" class="btn btn-dark">Retour</a>
		</div>
	</div>
	<div class="row">
		<div class="col-lg-1"></div>
		<div class="col">
			<?php
			include('../view/_errors.php');
			?>
		</div>
		<div class="col-lg-1"></div>
	</div>


<?php include 'exploit-plateforme/11-edit-plateforme.php' ?>


</div>


<?php
require '../view/_footer-bt.php';
?>